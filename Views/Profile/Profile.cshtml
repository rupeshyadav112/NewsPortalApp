@model NewsPortalApp.Models.UserProfile
@{
    ViewData["Title"] = "Profile";
    var profileImage = Model?.ProfileImagePath ?? "/images/avatar.png";
    // var isGoogleAccount = Model?.IsGoogleAccount ?? false;
}
<link rel="stylesheet" href="~/css/Profile.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<div class="main-container">
    <partial name="_Sidebar" />

    <main class="main-content">
        <div class="container">
            <div class="profile-container">
                <h2 class="profile-heading">Update Your Profile</h2>

                @if (TempData["Message"] != null)
                {
                    <div class="alert @((bool)TempData["IsSuccess"] ? "alert-success" : "alert-danger")">
                        @TempData["Message"]
                    </div>
                }

                <form asp-action="UpdateProfile" enctype="multipart/form-data" method="post">
                    @Html.AntiForgeryToken()

                    <div class="profile-image-section">
                        <div class="image-upload-wrapper" onclick="document.getElementById('ProfileImage').click();">
                            <img src="@profileImage" class="profile-image-preview" id="profileImagePreview" />
                            <div class="upload-overlay">
                                <i class="fas fa-camera upload-icon"></i>
                            </div>
                        </div>
                        <input type="file" asp-for="ProfileImage" class="d-none" id="ProfileImage"
                               accept="image/png, image/jpeg"
                               onchange="previewImage(this)" />
                        <span asp-validation-for="ProfileImage" class="text-danger image-validation"></span>
                    </div>

                    <div class="form-fields">
                        <div class="form-group">
                            <label asp-for="FullName" class="form-label"></label>
                            <input asp-for="FullName" class="form-control" />
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" type="email" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        @* @if (!isGoogleAccount) *@

                        <div class="form-group">
                            <label asp-for="Password" class="form-label">New Password (Optional)</label>
                            <input asp-for="Password" type="password" class="form-control"
                                   placeholder="Minimum 6 characters" />
                            <span asp-validation-for="Password" class="text-danger"></span>
                        </div>

                    </div>

                    <div class="form-actions">
                        <form asp-action="DeleteAccount" method="post" id="deleteForm">
                            @Html.AntiForgeryToken()
                            <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                                <i class="fas fa-trash-alt"></i> Delete Account
                            </button>
                        </form>

                        <div class="right-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Update Profile
                            </button>
                            <form asp-action="Logout" method="post">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </form>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function previewImage(input) {
            const preview = document.getElementById('profileImagePreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    preview.classList.add('uploaded-image');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function confirmDelete() {
            Swal.fire({
                title: 'Are you absolutely sure?',
                text: "This will permanently delete your account and all data!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('deleteForm').submit();
                }
            });
        }

        // Auto-close alerts after 5 seconds
        window.setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.transition = 'opacity 0.5s';
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 500);
            });
        }, 5000);
    </script>
}